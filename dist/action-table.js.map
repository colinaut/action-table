{"version":3,"file":"action-table.js","sources":["../src/action-table-no-results.ts","../src/action-table.ts"],"sourcesContent":["import { FiltersObject } from \"./types\";\nimport type { ActionTable } from \"./action-table\";\n\n/* -------------------------------------------------------------------------- */\n/*                           Action Table No Results                          */\n/* -------------------------------------------------------------------------- */\n/* ---------- Simple HTML element wrapper to allow reset of filters --------- */\n\nexport class ActionTableNoResults extends HTMLElement {\n\tconstructor() {\n\t\tsuper();\n\t\tconst actionTable = this.closest(\"action-table\") as ActionTable;\n\t\t// Hide on loading\n\t\tthis.style.display = \"none\";\n\t\tthis.addEventListener(\"click\", (e) => {\n\t\t\t// if target is reset button\n\t\t\tif (e.target instanceof HTMLButtonElement && e.target.type === \"reset\") {\n\t\t\t\t// reset the filters on the table element\n\t\t\t\tthis.dispatchEvent(\n\t\t\t\t\tnew CustomEvent<FiltersObject>(\"action-table-filter\", {\n\t\t\t\t\t\tbubbles: true,\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t\t// reset the filters on the action-table-filters\n\t\t\t\tthis.dispatchEvent(new CustomEvent<undefined>(\"action-table-filters-reset\", { bubbles: true }));\n\t\t\t}\n\t\t});\n\n\t\tactionTable.addEventListener(\"action-table\", (e) => {\n\t\t\tconst detail = e.detail;\n\t\t\t// console.log(\"action-table\", detail);\n\n\t\t\tif (detail?.rowsVisible === 0) {\n\t\t\t\tthis.style.display = \"\";\n\t\t\t} else {\n\t\t\t\tthis.style.display = \"none\";\n\t\t\t}\n\t\t});\n\t}\n\n\t/* -------------------------------------------------------------------------- */\n\t/*                              Private Methods                              */\n\t/* -------------------------------------------------------------------------- */\n\n\t/* ----------------- Send Event Triggered by checkbox change ---------------- */\n}\n\ncustomElements.define(\"action-table-no-results\", ActionTableNoResults);\n","import { ColsArray, FiltersObject, SingleFilterObject, ActionTableCellData, ActionTableEventDetail, Direction, ActionTableStore } from \"./types\";\nimport \"./action-table-no-results\";\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction hasKeys(obj: any): boolean {\n\treturn Object.keys(obj).length > 0;\n}\n\nexport class ActionTable extends HTMLElement {\n\tconstructor() {\n\t\tsuper();\n\n\t\t/* -------------------------------------------------------------------------- */\n\t\t/*                                    Init                                    */\n\t\t/* -------------------------------------------------------------------------- */\n\t\t/* ------------------- Only fires once on js initial load ------------------- */\n\t\t/* --------------- Does not require the inner DOM to be ready --------------- */\n\n\t\t// 1. Get sort and direction and filters from local storage\n\t\tif (this.store) {\n\t\t\t// 1. Get sort and direction and filters from local storage\n\t\t\tconst lsActionTable = this.getStore();\n\t\t\tif (lsActionTable) {\n\t\t\t\tthis.sort = lsActionTable.sort || this.sort;\n\t\t\t\tthis.direction = lsActionTable.direction || this.direction || \"ascending\";\n\t\t\t\tthis.filters = lsActionTable.filters || this.filters;\n\t\t\t}\n\t\t}\n\n\t\t// 2. Get sort and direction and filters from URL (overrides local storage)\n\t\tif (this.hasAttribute(\"urlparams\")) {\n\t\t\tconst params = new URLSearchParams(window.location.search);\n\n\t\t\t// sort through remaining params for filters to create a filters object\n\t\t\tconst filters: FiltersObject = {};\n\t\t\tfor (let [key, value] of params.entries()) {\n\t\t\t\tkey = key.toLowerCase();\n\t\t\t\tvalue = value.toLowerCase();\n\t\t\t\t// Only add key if it's not sort or direction\n\t\t\t\tif (key !== \"sort\" && key !== \"direction\") {\n\t\t\t\t\t// check for value and if so add it to the array.\n\t\t\t\t\tif (filters[key]?.values) {\n\t\t\t\t\t\tfilters[key].values.push(value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// if not, create it\n\t\t\t\t\t\tfilters[key] = { values: [value] };\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (key === \"sort\") {\n\t\t\t\t\tthis.sort = value;\n\t\t\t\t}\n\t\t\t\tif (key === \"direction\" && (value === \"ascending\" || value === \"descending\")) {\n\t\t\t\t\tthis.direction = value;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// if filters object is not empty, set this.filters\n\t\t\tif (Object.keys(filters).length > 0) {\n\t\t\t\tthis.setFiltersObject(filters);\n\t\t\t}\n\t\t}\n\n\t\tthis.addEventListeners();\n\t}\n\n\tpublic table!: HTMLTableElement;\n\tpublic tbody!: HTMLTableSectionElement;\n\tpublic cols: ColsArray = [];\n\tpublic rows: Array<HTMLTableRowElement> = [];\n\tpublic filters: FiltersObject = {};\n\n\t/* -------------------------------------------------------------------------- */\n\t/*                                 Attributes                                 */\n\t/* -------------------------------------------------------------------------- */\n\n\t// sort attribute to set the sort column\n\n\tget sort(): string {\n\t\treturn this.getCleanAttr(\"sort\");\n\t}\n\tset sort(value: string) {\n\t\tthis.setAttribute(\"sort\", value);\n\t}\n\n\t// direction attribute to set the sort direction\n\tget direction(): Direction | null {\n\t\tconst direction = this.getCleanAttr(\"direction\");\n\t\tif (direction === \"ascending\" || direction === \"descending\") {\n\t\t\treturn direction;\n\t\t} else return null;\n\t}\n\tset direction(value: Direction) {\n\t\tthis.setAttribute(\"direction\", value);\n\t}\n\n\t// store attribute to trigger loading and saving to sort and filters localStorage\n\tget store(): string {\n\t\treturn this.hasAttribute(\"store\") ? this.getCleanAttr(\"store\") || \"action-table\" : \"\";\n\t}\n\n\tget pagination(): number {\n\t\treturn Number(this.getCleanAttr(\"pagination\")) || 0;\n\t}\n\n\tset pagination(value: number) {\n\t\tthis.setAttribute(\"pagination\", value.toString());\n\t}\n\n\tget page(): number {\n\t\treturn Number(this.getCleanAttr(\"page\")) || 1;\n\t}\n\n\tset page(value: number) {\n\t\tvalue = this.checkPage(value);\n\t\tthis.setAttribute(\"page\", value.toString());\n\t}\n\n\tprivate checkPage(page: number): number {\n\t\treturn Math.max(1, Math.min(page, this.numberOfPages));\n\t}\n\n\tprivate dispatch(detail: ActionTableEventDetail) {\n\t\t// console.log(\"dispatch\", detail);\n\t\tthis.dispatchEvent(\n\t\t\tnew CustomEvent<ActionTableEventDetail>(\"action-table\", {\n\t\t\t\tdetail,\n\t\t\t})\n\t\t);\n\t}\n\n\tpublic tableContent = new WeakMap<HTMLTableCellElement, ActionTableCellData>();\n\t// set of rows that are shown in table based on filters\n\tpublic rowsSet = new Set<HTMLTableRowElement>();\n\n\tprivate getCleanAttr(attr: string): string {\n\t\treturn this.getAttribute(attr)?.trim().toLowerCase() || \"\";\n\t}\n\n\t/* -------------------------------------------------------------------------- */\n\t/*                             Connected Callback                             */\n\t/* -------------------------------------------------------------------------- */\n\t/* ------------- Fires every time the event is added to the DOM ------------- */\n\n\tpublic connectedCallback(): void {\n\t\t/* -------------- Init code which requires DOM to be ready -------------- */\n\t\tconsole.time(\"Connected Callback\");\n\n\t\t// 1. Get table, tbody, rows, and column names in this.cols\n\t\tconst table = this.querySelector(\"table\");\n\t\t// make sure table with thead and tbody exists\n\t\tif (table && table.querySelector(\"thead th\") && table.querySelector(\"tbody td\")) {\n\t\t\tthis.table = table;\n\t\t\t// casting type as we know it exists due to querySelector above\n\t\t\tthis.tbody = table.querySelector(\"tbody\") as HTMLTableSectionElement;\n\t\t\tthis.rows = Array.from(this.tbody.querySelectorAll(\"tr\")) as Array<HTMLTableRowElement>;\n\t\t\t// add each row to rowsSet\n\t\t\tthis.rowsSet = new Set(this.rows);\n\t\t} else {\n\t\t\tthrow new Error(\"Could not find table with thead and tbody\");\n\t\t}\n\t\t// 2. Hide tbody if there is sort or filters; then sort and filter\n\t\tif (this.sort || hasKeys(this.filters)) {\n\t\t\tthis.tbody.style.display = \"none\";\n\t\t\tthis.sortAndFilter();\n\t\t}\n\n\t\tthis.getColumns();\n\n\t\tthis.addObserver();\n\n\t\tconsole.timeEnd(\"Connected Callback\");\n\t\tconsole.log(\"store:\", this.store);\n\t}\n\n\t/* -------------------------------------------------------------------------- */\n\t/*                         Attribute Changed Callback                        */\n\t/* -------------------------------------------------------------------------- */\n\n\tstatic get observedAttributes(): string[] {\n\t\treturn [\"sort\", \"direction\", \"pagination\", \"page\"];\n\t}\n\tpublic attributeChangedCallback(name: string, oldValue: string, newValue: string) {\n\t\t// only fires if the value actually changes and if the rows is not empty, which means it has grabbed the cellContent\n\t\tif (oldValue !== newValue && this.rows.length > 0) {\n\t\t\tif (name === \"sort\" || name === \"direction\") {\n\t\t\t\tconsole.log(\"attributeChangedCallback: sort\", oldValue, newValue);\n\t\t\t\tthis.sortTable();\n\t\t\t}\n\t\t\tif (name === \"pagination\") {\n\t\t\t\t// console.log(\"attributeChangedCallback: pagination\", oldValue, newValue);\n\t\t\t\tthis.dispatch({ pagination: this.pagination });\n\t\t\t}\n\t\t\tthis.appendRows();\n\t\t}\n\t}\n\n\t/* -------------------------------------------------------------------------- */\n\t/*                               PRIVATE METHODS                              */\n\t/* -------------------------------------------------------------------------- */\n\n\t/* -------------------------------------------------------------------------- */\n\t/*                           Filter variable methods                          */\n\t/* -------------------------------------------------------------------------- */\n\n\tprivate setFiltersObject(filters: FiltersObject = {}): void {\n\t\t// If set empty it resets filters to default\n\n\t\tthis.filters = filters;\n\n\t\tif (this.store) this.setStore({ filters: this.filters });\n\t}\n\n\t/* ----------- Used by reset button and action-table-filter event ----------- */\n\tprivate setFilters(filters: FiltersObject = {}) {\n\t\tthis.setFiltersObject(filters);\n\t\tthis.filterTable();\n\t\tthis.appendRows();\n\t}\n\n\t/* -------------------------------------------------------------------------- */\n\t/*                  Private Method: add event listeners                       */\n\t/* -------------------------------------------------------------------------- */\n\n\tprivate addEventListeners(): void {\n\t\t// Sort buttons\n\t\tthis.addEventListener(\n\t\t\t\"click\",\n\t\t\t(event) => {\n\t\t\t\tconst el = event.target;\n\t\t\t\t// only fire if event target is a button with data-col\n\t\t\t\tif (el instanceof HTMLButtonElement && el.dataset.col) {\n\t\t\t\t\tconst name = el.dataset.col;\n\t\t\t\t\tlet direction: Direction = \"ascending\";\n\t\t\t\t\tif (this.sort === name && this.direction === \"ascending\") {\n\t\t\t\t\t\tdirection = \"descending\";\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.sort = name;\n\t\t\t\t\tthis.direction = direction;\n\t\t\t\t\tif (this.store) this.setStore({ sort: this.sort, direction: direction });\n\t\t\t\t}\n\t\t\t},\n\t\t\tfalse\n\t\t);\n\n\t\tconst findCell = (el: HTMLElement) => {\n\t\t\treturn (el.matches(\"td\") ? el : el.closest(\"td\")) as HTMLTableCellElement;\n\t\t};\n\n\t\t// Listens for checkboxes in the table since mutation observer does not support checkbox changes\n\t\tthis.addEventListener(\"change\", (event) => {\n\t\t\tconst el = event.target;\n\t\t\t// only fire if event target is a checkbox in a td; this stops it firing for filters\n\t\t\tif (el instanceof HTMLInputElement && el.closest(\"td\") && el.type === \"checkbox\") {\n\t\t\t\t// get new content, sort and filter. This works for checkboxes and action-table-switch\n\t\t\t\tconsole.log(\"event change\", el);\n\t\t\t\tthis.updateCellValues(findCell(el));\n\t\t\t}\n\t\t});\n\n\t\t// Listens for action-table-filter event from action-table-filters\n\t\tthis.addEventListener(`action-table-filter`, (event) => {\n\t\t\tif (event.detail) {\n\t\t\t\t// 1. If detail is defined then add it to the filters object\n\t\t\t\tconst filters = { ...this.filters, ...event.detail };\n\t\t\t\t// 2. Remove empty filters\n\t\t\t\tObject.keys(filters).forEach((key) => {\n\t\t\t\t\tif (filters[key].values.every((value) => value === \"\")) {\n\t\t\t\t\t\tdelete filters[key];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t// 3. Set filters with new filters object\n\t\t\t\tthis.setFilters(filters);\n\t\t\t} else {\n\t\t\t\t// 3. if no detail than reset filters by calling setFilters with empty object\n\t\t\t\tthis.setFilters();\n\t\t\t}\n\t\t});\n\n\t\t// Listens for action-table-update event used by custom elements that want to announce content changes\n\t\tthis.addEventListener(`action-table-update`, (event) => {\n\t\t\tconst target = event.target;\n\t\t\tif (target instanceof HTMLElement) {\n\t\t\t\tlet values: Partial<ActionTableCellData> = {};\n\t\t\t\tif (typeof event.detail === \"string\") {\n\t\t\t\t\tvalues = { sort: event.detail, filter: event.detail };\n\t\t\t\t} else values = event.detail;\n\t\t\t\tthis.updateCellValues(findCell(target), values);\n\t\t\t}\n\t\t});\n\t}\n\n\t/* -------------------------------------------------------------------------- */\n\t/*                      Private Method: Get localStorage                      */\n\t/* -------------------------------------------------------------------------- */\n\n\tprivate getStore() {\n\t\ttry {\n\t\t\tconst ls = localStorage.getItem(this.store);\n\t\t\tconst data = ls && JSON.parse(ls);\n\t\t\tif (typeof data === \"object\" && data !== null) {\n\t\t\t\tconst hasKeys = [\"sort\", \"direction\", \"filters\"].some((key) => key in data);\n\t\t\t\tif (hasKeys) return data as ActionTableStore;\n\t\t\t}\n\t\t\treturn false;\n\t\t} catch (e) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/* -------------------------------------------------------------------------- */\n\t/*                      Private Method: Set localStorage                      */\n\t/* -------------------------------------------------------------------------- */\n\n\tprivate setStore(data: ActionTableStore) {\n\t\tconst lsData = this.getStore() || {};\n\t\tif (lsData) {\n\t\t\tdata = { ...lsData, ...data };\n\t\t}\n\t\tlocalStorage.setItem(this.store, JSON.stringify(data));\n\t}\n\n\t/* -------------------------------------------------------------------------- */\n\t/*      Private Method delaying sortAndFilter until it's no longer called     */\n\t/* -------------------------------------------------------------------------- */\n\n\tprivate delayUntilNoLongerCalled(callback: () => void) {\n\t\tlet timeoutId: number;\n\t\tlet isCalling = false;\n\n\t\tfunction delayedCallback() {\n\t\t\t// Execute the callback\n\t\t\tcallback();\n\n\t\t\t// Reset the flag variable to false\n\t\t\tisCalling = false;\n\t\t}\n\n\t\treturn function () {\n\t\t\t// If the function is already being called, clear the previous timeout\n\t\t\tif (isCalling) {\n\t\t\t\tclearTimeout(timeoutId);\n\t\t\t} else {\n\t\t\t\t// Set the flag variable to true if the function is not already being called\n\t\t\t\tisCalling = true;\n\t\t\t}\n\n\t\t\t// Set a new timeout to execute the delayed callback after 10ms\n\t\t\ttimeoutId = setTimeout(delayedCallback, 10);\n\t\t};\n\t}\n\n\t/* ------------------------- Delayed Sort and Filter ------------------------ */\n\n\tprivate sortAndFilter = this.delayUntilNoLongerCalled(() => {\n\t\tconsole.log(\"ðŸŽ² sortAndFilter\");\n\t\tthis.filterTable();\n\t\tthis.sortTable();\n\t\tthis.appendRows();\n\t\t// If tbody is hidden then this is the initial render\n\t\tif (this.tbody.matches(\"[style*=none]\")) {\n\t\t\t// if there are no rows then automatically reset filters\n\t\t\tif (this.rowsSet.size === 0) {\n\t\t\t\tconsole.error(\"no results found on initial render\");\n\t\t\t\tthis.setFilters();\n\t\t\t\tthis.dispatchEvent(new Event(`action-table-filters-reset`));\n\t\t\t}\n\t\t\t// show tbody\n\t\t\tthis.tbody.style.display = \"\";\n\t\t}\n\t});\n\n\t/* -------------------------------------------------------------------------- */\n\t/*                 Private Method: get columns from table                      */\n\t/* -------------------------------------------------------------------------- */\n\n\tprivate getColumns(): void {\n\t\t// console.time(\"getColumns\");\n\t\t// 1. Get column headers\n\t\t// casting type as we know what it is from selector\n\t\tconst ths = this.table.querySelectorAll(\"thead th\") as NodeListOf<HTMLTableCellElement>;\n\n\t\tths.forEach((th) => {\n\t\t\t// 2. Column name is based on data-col attribute or results of getCellContent() function\n\t\t\tconst name = (th.dataset.col || this.getCellContent(th)).trim().toLowerCase();\n\t\t\tconst order = th.dataset.order ? th.dataset.order.split(\",\") : undefined;\n\n\t\t\t// 4. Add column name to cols array\n\t\t\tthis.cols.push({ name, order });\n\n\t\t\t// 5. if the column is sortable then wrap it in a button, and add aria\n\t\t\tif (!th.hasAttribute(\"no-sort\")) {\n\t\t\t\tconst button = document.createElement(\"button\");\n\t\t\t\tbutton.dataset.col = name;\n\t\t\t\tbutton.type = \"button\";\n\t\t\t\tbutton.innerHTML = th.innerHTML;\n\t\t\t\tth.replaceChildren(button);\n\t\t\t}\n\t\t});\n\n\t\t// 7. add colGroup unless it already exists\n\t\tif (!this.table.querySelector(\"colgroup\")) {\n\t\t\t// 7.1 create colgroup\n\t\t\tconst colGroup = document.createElement(\"colgroup\");\n\t\t\t// 7.2 add col for each column\n\t\t\tths.forEach(() => {\n\t\t\t\tconst col = document.createElement(\"col\");\n\t\t\t\tcolGroup.appendChild(col);\n\t\t\t});\n\t\t\t// 7.3 prepend colgroup\n\t\t\tthis.table.prepend(colGroup);\n\t\t}\n\t\t// console.log(\"action-table cols\", this.cols);\n\t\t// 8. Return cols array\n\t\t// console.timeEnd(\"getColumns\");\n\t}\n\n\t/* -------------------------------------------------------------------------- */\n\t/*                     Private Method: get cell content                        */\n\t/* -------------------------------------------------------------------------- */\n\tprivate getCellContent(cell: HTMLTableCellElement): string {\n\t\t// 1. get cell content with innerText; set to empty string if null\n\t\tlet cellContent: string = (cell.textContent || \"\").trim();\n\n\t\t// 3. if there is no cell content then check...\n\t\tif (!cellContent) {\n\t\t\t// 3.1 if there is an svg then get title; otherwise return empty string\n\t\t\tconst svg = cell.querySelector(\"svg\");\n\t\t\tif (svg instanceof SVGElement) {\n\t\t\t\tcellContent = svg.querySelector(\"title\")?.textContent || cellContent;\n\t\t\t}\n\t\t\t// 3.2 if checkbox element then get value if checked\n\t\t\tconst checkbox = cell.querySelector(\"input[type=checkbox]\");\n\t\t\tif (checkbox instanceof HTMLInputElement && checkbox.checked) {\n\t\t\t\tcellContent = checkbox.value;\n\t\t\t}\n\t\t\t// 3.3 if custom element with shadowRoot then get text content from shadowRoot\n\t\t\tconst customElement = cell.querySelector(\":defined\");\n\t\t\tif (customElement?.shadowRoot) {\n\t\t\t\tcellContent = customElement.shadowRoot.textContent || cellContent;\n\t\t\t}\n\t\t}\n\n\t\treturn cellContent.trim();\n\t}\n\n\t/* ------------------------------------------------------------------------- */\n\t/*              Private Method: Set Cell Content in td attribute              */\n\t/* -------------------------------------------------------------------------- */\n\n\tpublic getCellValues(cell: HTMLTableCellElement): ActionTableCellData {\n\t\t// 1. If data exists return it; else get it\n\t\tif (this.tableContent.has(cell)) {\n\t\t\t// console.log(\"getCellValues: Cached\");\n\t\t\t// @ts-expect-error has checks for data\n\t\t\treturn this.tableContent.get(cell);\n\t\t} else {\n\t\t\tconst cellValues = this.setCellValues(cell);\n\t\t\t// console.log(\"getCellValues: Set\", cellValues);\n\t\t\treturn cellValues;\n\t\t}\n\t}\n\n\tprivate setCellValues(cell: HTMLTableCellElement, values: Partial<ActionTableCellData> = {}) {\n\t\tconst cellContent = this.getCellContent(cell);\n\t\tconst cellValues = { sort: cell.dataset.sort || cellContent, filter: cell.dataset.filter || cellContent, ...values };\n\t\tthis.tableContent.set(cell, cellValues);\n\t\treturn cellValues;\n\t}\n\n\tprivate updateCellValues(cell: HTMLTableCellElement, values: Partial<ActionTableCellData> = {}) {\n\t\tthis.setCellValues(cell, values);\n\t\tthis.sortAndFilter();\n\t}\n\n\t/* -------------------------------------------------------------------------- */\n\t/*                        Private Method: Add Observer                        */\n\t/* -------------------------------------------------------------------------- */\n\n\tprivate addObserver() {\n\t\t// Good reference for MutationObserver: https://davidwalsh.name/mutationobserver-api\n\t\t// 1. Create an observer instance\n\t\tconst observer = new MutationObserver((mutations) => {\n\t\t\t// Make sure it only gets content once if there are several changes at the same time\n\t\t\t// 1.1 sort through all mutations\n\t\t\tmutations.forEach((mutation) => {\n\t\t\t\tlet target = mutation.target;\n\t\t\t\t// If target is a text node, get its parentNode\n\t\t\t\tif (target.nodeType === 3 && target.parentNode) target = target.parentNode;\n\t\t\t\t// ignore if this is not an HTMLElement\n\t\t\t\tif (!(target instanceof HTMLElement)) return;\n\t\t\t\t// Get parent td\n\t\t\t\tconst td = target.closest(\"td\");\n\t\t\t\t// Only act on HTMLTableCellElements\n\t\t\t\tif (td instanceof HTMLTableCellElement) {\n\t\t\t\t\t// If this is a contenteditable element that is focused then only update on blur\n\t\t\t\t\tif (td.hasAttribute(\"contenteditable\") && td === document.activeElement) {\n\t\t\t\t\t\t// add function for event listener\n\t\t\t\t\t\t// Make sure that the event listener is only added once\n\t\t\t\t\t\tif (!td.dataset.edit) {\n\t\t\t\t\t\t\ttd.dataset.edit = \"true\";\n\t\t\t\t\t\t\ttd.addEventListener(\"blur\", () => {\n\t\t\t\t\t\t\t\tthis.updateCellValues(td);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// else update\n\t\t\t\t\t\tthis.updateCellValues(td);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Ignore tbody changes which happens whenever a new row is added with sort\n\t\t\t});\n\t\t});\n\t\tobserver.observe(this.tbody, { childList: true, subtree: true, attributes: true, characterData: true, attributeFilter: [\"data-sort\", \"data-filter\"] });\n\t}\n\n\t/* -------------------------------------------------------------------------- */\n\t/*            Private Method: filter table on column name and value            */\n\t/* -------------------------------------------------------------------------- */\n\t/* ------------- Used by filters in action-table-filter element ------------- */\n\t/* ------------- Also triggered by local storage and URL params ------------- */\n\n\tprivate filterTable(): void {\n\t\tconsole.log(\"filterTable\", this.filters);\n\n\t\t// eslint-disable-next-line no-console\n\t\t// console.time(\"filterTable\");\n\n\t\t// 1. Save current state of numberOfPages\n\t\tconst currentNumberOfPages = this.numberOfPages;\n\t\tconst currentRowsVisible = this.rowsSet.size;\n\n\t\t// 2. get filter value for whole row based on special reserved name \"action-table\"\n\t\tconst filterForWholeRow = this.filters[\"action-table\"];\n\n\t\tthis.rows.forEach((row) => {\n\t\t\t// 3.1 set base display value as \"\"\n\t\t\tlet hide = false;\n\t\t\t// 3.2 get td cells\n\t\t\tconst cells = row.querySelectorAll(\"td\") as NodeListOf<HTMLTableCellElement>;\n\t\t\t// 3.3 if filter value for whole row exists then run filter against innerText of entire row content\n\t\t\tif (filterForWholeRow) {\n\t\t\t\t// 3.3.1 build string of all td data-filter values, ignoring checkboxes\n\t\t\t\t// console.log(\"filterForWholeRow\");\n\t\t\t\t// TODO: add ability to only filter some columns data-ignore with name or index or data-only attribute\n\t\t\t\tconst cellsFiltered = Array.from(cells).filter((_c, i) => {\n\t\t\t\t\tconsole.log(\"ðŸš€ ~ ActionTable ~ this.cols[i].name:\", this.filters[\"action-table\"].cols, this.cols[i].name);\n\t\t\t\t\treturn this.filters[\"action-table\"].cols ? this.filters[\"action-table\"].cols.includes(this.cols[i].name.toLowerCase()) : true;\n\t\t\t\t});\n\t\t\t\tconsole.log(\"ðŸš€ ~ ActionTable ~ this.rows.forEach ~ cellsFiltered:\", cellsFiltered);\n\n\t\t\t\tconst content = cellsFiltered.map((cell) => (cell.querySelector('input[type=\"checkbox\"]') ? \"\" : this.getCellValues(cell).filter)).join(\" \");\n\n\t\t\t\tif (this.shouldHide(filterForWholeRow, content)) {\n\t\t\t\t\thide = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// 3.4 if columnName is not action-table then run filter against td cell content\n\t\t\tcells.forEach((cell, i) => {\n\t\t\t\tconst filter = this.filters[this.cols[i].name];\n\t\t\t\tif (!filter) return;\n\t\t\t\t// console.log(\"filter cell\", filter);\n\n\t\t\t\tif (this.shouldHide(filter, this.getCellValues(cell).filter)) {\n\t\t\t\t\thide = true;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// 3.5 set display\n\t\t\tif (hide) {\n\t\t\t\tthis.rowsSet.delete(row);\n\t\t\t} else {\n\t\t\t\tthis.rowsSet.add(row);\n\t\t\t}\n\t\t});\n\n\t\t// 4. If number of pages changed, update pagination\n\t\tconsole.log(\"currentNumberOfPages\", currentNumberOfPages, this.numberOfPages);\n\n\t\tif (this.numberOfPages !== currentNumberOfPages) {\n\t\t\tthis.dispatch({ numberOfPages: this.numberOfPages });\n\t\t}\n\t\tif (this.rowsSet.size !== currentRowsVisible) {\n\t\t\tthis.dispatch({ rowsVisible: this.rowsSet.size });\n\t\t}\n\t\t// console.timeEnd(\"filterTable\");\n\t}\n\n\tprivate shouldHide(filter: SingleFilterObject, content: string): boolean {\n\t\t// console.log(\"shouldHide\", filter, content);\n\t\tif (filter.values && filter.values.length > 0) {\n\t\t\t// 1. build regex from filterValues array (checkboxes and select menus send arrays)\n\t\t\tif (filter.regex) {\n\t\t\t\tlet regexPattern = filter.values.join(\"|\");\n\t\t\t\tif (filter.exclusive) {\n\t\t\t\t\tconst regexParts = filter.values.map((str) => `(?=.*${str})`);\n\t\t\t\t\tregexPattern = `${regexParts.join(\"\")}.*`;\n\t\t\t\t}\n\t\t\t\tconst regex = new RegExp(regexPattern, \"i\");\n\n\t\t\t\t// 2. check if content matches\n\t\t\t\treturn !regex.test(content);\n\t\t\t}\n\t\t\tif (filter.range) {\n\t\t\t\tconst [min, max] = filter.values;\n\t\t\t\t// TODO: Maybe allow for alphabetical ranges?\n\t\t\t\tif (!isNaN(Number(min)) && !isNaN(Number(max))) return Number(content) < Number(min) || Number(content) > Number(max);\n\t\t\t}\n\t\t\t// console.log(\"show\", columnName, content);\n\t\t\tif (filter.exclusive) {\n\t\t\t\treturn !filter.values.every((v) => content.toLowerCase().includes(v.toLowerCase()));\n\t\t\t}\n\t\t\tif (filter.exact) {\n\t\t\t\treturn filter.values.every((v) => v && v !== content);\n\t\t\t}\n\t\t\treturn !filter.values.some((v) => content.toLowerCase().includes(v.toLowerCase()));\n\t\t}\n\t\treturn false;\n\t}\n\n\t/* -------------------------------------------------------------------------- */\n\t/*        Private Method: sort table based on column name and direction        */\n\t/* -------------------------------------------------------------------------- */\n\t/* ----------- Used by sort header buttons and attributes callback ----------- */\n\t/* ------------- Also triggered by local storage and URL params ------------- */\n\n\tprivate sortTable(columnName = this.sort, direction = this.direction) {\n\t\tif (!this.sort || !direction) return;\n\t\t// eslint-disable-next-line no-console\n\t\t// console.time(\"sortTable\");\n\t\tcolumnName = columnName.toLowerCase();\n\t\t// 1. Get column index from column name\n\t\tconst columnIndex = this.cols.findIndex((col) => col.name === columnName);\n\n\t\t// 2. If column exists and there are rows then sort\n\t\tif (columnIndex >= 0 && this.rows.length > 0) {\n\t\t\tconsole.log(`sort by ${columnName} ${direction}`);\n\n\t\t\t// 1 Get sort order for column if it exists\n\t\t\tconst sortOrder = this.cols[columnIndex].order;\n\t\t\t// helper function to return sort order index for row sort\n\t\t\tconst checkSortOrder = (value: string) => {\n\t\t\t\treturn sortOrder?.includes(value) ? sortOrder.indexOf(value).toString() : value;\n\t\t\t};\n\n\t\t\t// 2. Sort rows\n\t\t\tthis.rows.sort((r1, r2) => {\n\t\t\t\t// 1. If descending sort, swap rows\n\t\t\t\tif (direction === \"descending\") {\n\t\t\t\t\tconst temp = r1;\n\t\t\t\t\tr1 = r2;\n\t\t\t\t\tr2 = temp;\n\t\t\t\t}\n\n\t\t\t\t// 2. Get content from stored actionTable.sort; If it matches value in sort order exists then return index\n\t\t\t\tconst a: string = checkSortOrder(this.getCellValues(r1.children[columnIndex] as HTMLTableCellElement).sort);\n\t\t\t\tconst b: string = checkSortOrder(this.getCellValues(r2.children[columnIndex] as HTMLTableCellElement).sort);\n\n\t\t\t\t// console.log(\"a\", a, \"b\", b);\n\n\t\t\t\treturn this.alphaNumSort(a, b);\n\t\t\t});\n\n\t\t\t// 3. Add sorted class to columns\n\t\t\tconst colGroupCols = this.querySelectorAll(\"col\");\n\t\t\tcolGroupCols.forEach((colGroupCol, i) => {\n\t\t\t\tif (i === columnIndex) {\n\t\t\t\t\tcolGroupCol.classList.add(\"sorted\");\n\t\t\t\t} else {\n\t\t\t\t\tcolGroupCol.classList.remove(\"sorted\");\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// 3. set aria sorting direction\n\t\t\tconst ths = this.table.querySelectorAll(\"thead th\");\n\t\t\tths.forEach((th, i) => {\n\t\t\t\tconst ariaSort = i === columnIndex ? direction : \"none\";\n\t\t\t\tth.setAttribute(\"aria-sort\", ariaSort);\n\t\t\t});\n\t\t}\n\t\t// eslint-disable-next-line no-console\n\t\t// console.timeEnd(\"sortTable\");\n\t}\n\n\t/* --------------------------- Public Sort Method --------------------------- */\n\t// Also used by action-table-filter-menu.js when building options menu\n\n\tpublic alphaNumSort(a: string, b: string): number {\n\t\tfunction isNumberOrDate(value: string): number | void {\n\t\t\tif (!isNaN(Number(value))) {\n\t\t\t\treturn Number(value);\n\t\t\t} else if (!isNaN(Date.parse(value))) {\n\t\t\t\treturn Date.parse(value);\n\t\t\t}\n\t\t}\n\n\t\tconst aSort = isNumberOrDate(a);\n\t\tconst bSort = isNumberOrDate(b);\n\n\t\tif (aSort && bSort) {\n\t\t\treturn aSort - bSort;\n\t\t}\n\t\treturn a.localeCompare(b);\n\t}\n\n\t/* -------------------------------------------------------------------------- */\n\t/*                         Private Method: Append Rows                        */\n\t/* -------------------------------------------------------------------------- */\n\t/* --------- Sets row visibility based on sort,filter and pagination -------- */\n\n\tprivate appendRows(): void {\n\t\tconsole.time(\"appendRows\");\n\n\t\t// Helper function for hiding rows based on pagination\n\t\tconst isActivePage = (i: number): boolean => {\n\t\t\t// returns if pagination is enabled (> 0) and row is on current page.\n\t\t\t// For instance if the current page is 2 and pagination is 10 then is greater than 10 and less than or equal to 20\n\t\t\tconst { pagination, page } = this;\n\t\t\treturn pagination === 0 || (i >= pagination * (page - 1) + 1 && i <= pagination * page);\n\t\t};\n\n\t\t// fragment for holding rows\n\t\tconst fragment = document.createDocumentFragment();\n\t\t// This includes both rows hidden by filter and by pagination\n\t\tlet currentRowsVisible = 0;\n\n\t\t// loop through rows to set hide or show\n\t\tthis.rows.forEach((row) => {\n\t\t\tlet display = \"none\";\n\t\t\t// if row not hidden by filter\n\t\t\tif (this.rowsSet.has(row)) {\n\t\t\t\t// increment current rows\n\t\t\t\tcurrentRowsVisible++;\n\t\t\t\t// if row not hidden by pagination\n\t\t\t\tif (isActivePage(currentRowsVisible)) {\n\t\t\t\t\t// set display to show and add row to fragment\n\t\t\t\t\tdisplay = \"\";\n\t\t\t\t\tfragment.appendChild(row);\n\t\t\t\t}\n\t\t\t}\n\t\t\trow.style.display = display;\n\t\t});\n\n\t\t// prepend fragment to tbody\n\n\t\tthis.tbody.prepend(fragment);\n\n\t\tconsole.timeEnd(\"appendRows\");\n\n\t\tif (this.pagination > 0) {\n\t\t\t// If page is greater than number of pages, set page to number of pages\n\t\t\tconst page = this.checkPage(this.page);\n\t\t\tif (page !== this.page) {\n\t\t\t\t// update this.page\n\t\t\t\tthis.page = page;\n\t\t\t\t// Dispatch current page\n\t\t\t\tthis.dispatch({ page: page });\n\t\t\t}\n\t\t}\n\t}\n\n\tget numberOfPages(): number {\n\t\treturn this.pagination > 0 ? Math.ceil(this.rowsSet.size / this.pagination) : 1;\n\t}\n}\n\ncustomElements.define(\"action-table\", ActionTable);\n"],"names":["ActionTableNoResults","actionTable","e","detail","hasKeys","obj","ActionTable","_a","__publicField","lsActionTable","params","filters","key","value","direction","page","attr","table","name","oldValue","newValue","event","el","findCell","target","values","ls","data","lsData","callback","timeoutId","isCalling","delayedCallback","ths","th","order","button","colGroup","col","cell","cellContent","svg","checkbox","customElement","cellValues","mutations","mutation","td","currentNumberOfPages","currentRowsVisible","filterForWholeRow","row","hide","cells","content","_c","i","filter","regexPattern","str","min","max","v","columnName","columnIndex","sortOrder","checkSortOrder","r1","r2","temp","a","b","colGroupCol","ariaSort","isNumberOrDate","aSort","bSort","isActivePage","pagination","fragment","display"],"mappings":"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"}