{"version":3,"file":"action-table.js","sources":["../src/action-table.ts"],"sourcesContent":["export class ActionTable extends HTMLElement {\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\t// TODO: review if I really need all of these variables\n\tprivate tbody!: HTMLTableSectionElement;\n\tprivate ths!: NodeListOf<HTMLTableCellElement>;\n\tprivate cols: { name: string; index: number; filter?: string }[] = [];\n\tprivate rowsArray!: Array<HTMLTableRowElement>;\n\n\t/* -------------------------------------------------------------------------- */\n\t/*                                 Attributes                                 */\n\t/* -------------------------------------------------------------------------- */\n\n\tstatic get observedAttributes(): string[] {\n\t\treturn [\"sort\", \"direction\"];\n\t}\n\n\tget sort(): string {\n\t\treturn this.getAttribute(\"sort\")?.trim().toLowerCase() || \"\";\n\t}\n\tset sort(value) {\n\t\tif (typeof value === \"string\") this.setAttribute(\"sort\", value);\n\t}\n\tget direction(): string {\n\t\treturn this.getAttribute(\"direction\")?.trim().toLowerCase() || \"ascending\";\n\t}\n\tset direction(value) {\n\t\tif (typeof value === \"string\") this.setAttribute(\"direction\", value);\n\t}\n\n\tpublic connectedCallback(): void {\n\t\tconst table = this.querySelector(\"table\") as HTMLTableElement;\n\n\t\tthis.tbody = table.querySelector(\"tbody\") as HTMLTableSectionElement;\n\n\t\tthis.getColumns(table);\n\n\t\tconst rows = this.tbody.querySelectorAll(\"tbody tr\") as NodeListOf<HTMLTableRowElement>;\n\t\tthis.rowsArray = Array.from(rows);\n\n\t\t/* ----------------- Sort Table Element if attribute is set ----------------- */\n\t\tif (this.sort) {\n\t\t\tthis.sortTable();\n\t\t}\n\n\t\tthis.addEventListeners();\n\t}\n\n\tprivate getColumns(table: HTMLTableElement): Array<{ name: string; index: number; filter?: string }> {\n\t\tthis.ths = table.querySelectorAll(\"th\");\n\t\tif (this.ths) {\n\t\t\tthis.ths.forEach((th) => {\n\t\t\t\t// Column name is based on data-col attribute or title attribute of first child or text content of th or first child text content\n\t\t\t\tlet name = th.dataset.col || th.children[0]?.getAttribute(\"title\") || th.textContent || th.children[0]?.textContent || \"\";\n\t\t\t\tname = name.trim().toLowerCase();\n\t\t\t\tif (name) {\n\t\t\t\t\tthis.cols.push({ name: name, index: th.cellIndex });\n\t\t\t\t\tconst span = document.createElement(\"span\");\n\t\t\t\t\tspan.classList.add(\"sort-arrow\");\n\t\t\t\t\t// span.innerHTML = arrow_svg;\n\t\t\t\t\tth.append(span);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tconsole.log(\"action-table cols\", this.cols);\n\t\treturn this.cols;\n\t}\n\n\tpublic attributeChangedCallback(name: string, oldValue: string, newValue: string) {\n\t\tconsole.log(\"changed\", name, oldValue, newValue);\n\t}\n\n\tprivate addEventListeners(): void {\n\t\tthis.addEventListener(\n\t\t\t\"click\",\n\t\t\t(event) => {\n\t\t\t\tconst el = event.target as HTMLTableCellElement;\n\t\t\t\tif (el.tagName === \"TH\") {\n\t\t\t\t\tlet name = el.dataset.col || el.children[0]?.getAttribute(\"title\") || el.textContent || \"\";\n\t\t\t\t\tname = name.trim().toLowerCase();\n\t\t\t\t\tif (name) {\n\t\t\t\t\t\tif (this.sort === name && this.direction === \"ascending\") {\n\t\t\t\t\t\t\tthis.direction = \"descending\";\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.sort = name;\n\t\t\t\t\t\t\tthis.direction = \"ascending\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.sortTable();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tfalse\n\t\t);\n\n\t\t// TODO: add function to filter for numbers against a value range\n\t\t// TODO: add function to filter for dates against a date range\n\t\t// TODO: add function to filter for an array of strings so can have multiple select dropdown\n\n\t\t// Add listener for custom event \"action-table-filter\" which logs the event detail\n\t\tthis.addEventListener(\"action-table-filter\", (event) => {\n\t\t\tconst { col, value } = (<CustomEvent>event).detail;\n\t\t\tconsole.log(`Filter ${col} to ${value}`);\n\t\t\tthis.filterTable(col, value);\n\t\t});\n\n\t\tthis.addEventListener(\"action-table-filter-reset\", () => {\n\t\t\tthis.resetFilters();\n\t\t});\n\t}\n\n\tpublic resetFilters(): void {\n\t\t// remove all filters from this.col then call filterTable\n\t\tthis.cols.forEach((col) => {\n\t\t\tcol.filter = \"\";\n\t\t});\n\t\tthis.filterTable();\n\t\t// find all action-table-filter elements and call resetFilter\n\t\tinterface ActionTableFilter extends HTMLElement {\n\t\t\tresetFilter(options?: { dispatch: boolean }): void;\n\t\t}\n\t\tconst filterMenus = this.querySelectorAll(\"action-table-filter-menu, action-table-filter-switch\") as NodeListOf<ActionTableFilter>;\n\n\t\tfilterMenus?.forEach((el) => {\n\t\t\tel.resetFilter({ dispatch: false });\n\t\t});\n\t}\n\n\tpublic filterTable(col = \"\", value = \"\") {\n\t\tcol = col?.trim().toLowerCase();\n\t\tif (typeof value === \"string\") {\n\t\t\tvalue = value.trim();\n\t\t}\n\t\t// Add filter to cols array\n\t\t// if value = \"\" that resets the filter for that column\n\t\tthis.cols = this.cols.map((c) => {\n\t\t\tif (c.name === col) {\n\t\t\t\tc.filter = value;\n\t\t\t}\n\t\t\treturn c;\n\t\t});\n\n\t\t// Filter based on filter value\n\t\tthis.rowsArray.forEach((row) => {\n\t\t\trow.style.display = \"\";\n\t\t\tconst cells = row.children as HTMLCollectionOf<HTMLElement>;\n\t\t\tthis.cols.forEach((col) => {\n\t\t\t\tlet content = cells[col.index].textContent || cells[col.index].dataset.sort || \"\";\n\t\t\t\tcontent = content?.trim();\n\n\t\t\t\tif (col.filter && typeof col.filter === \"string\") {\n\t\t\t\t\tconst regex = new RegExp(col.filter, \"i\");\n\t\t\t\t\tif (regex.test(content)) {\n\t\t\t\t\t\t// row.style.display = \"table-row\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\trow.style.display = \"none\";\n\t\t\t\t\t}\n\t\t\t\t} else if (col.filter && Array.isArray(col.filter)) {\n\t\t\t\t\tconst filterArray = col.filter as string[];\n\t\t\t\t\tlet regexString = \"(\";\n\t\t\t\t\tfilterArray.forEach((value, i) => {\n\t\t\t\t\t\tregexString += `${value}`;\n\t\t\t\t\t\tregexString += i < filterArray.length - 1 ? \"|\" : \"\";\n\t\t\t\t\t});\n\t\t\t\t\tregexString += \")\";\n\t\t\t\t\tconst regex = new RegExp(regexString, \"i\");\n\t\t\t\t\tif (regex.test(content)) {\n\t\t\t\t\t\t// row.style.display = \"table-row\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\trow.style.display = \"none\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tthis.sortTable();\n\t}\n\n\tprivate getCellSortValue(cell: HTMLTableCellElement) {\n\t\tlet cellContent: string | number = cell.dataset.sort || cell.textContent || \"\";\n\t\tcellContent = Number(cellContent) ? Number(cellContent) : cellContent;\n\t\treturn cellContent;\n\t}\n\n\tsortTable(sort = this.sort, direction = this.direction) {\n\t\tsort = sort?.trim().toLowerCase();\n\t\tdirection = direction?.trim().toLowerCase();\n\t\t// Get column index from column name\n\t\tconst column_index = this.cols.findIndex((c) => c.name === sort);\n\t\t// Sort\n\t\tif (column_index >= 0 && this.rowsArray.length > 0) {\n\t\t\tconsole.log(`sort by ${sort} ${direction}`);\n\n\t\t\tthis.rowsArray.sort((r1, r2) => {\n\t\t\t\tconst c1 = r1.children[column_index] as HTMLTableCellElement;\n\t\t\t\tconst c2 = r2.children[column_index] as HTMLTableCellElement;\n\t\t\t\tlet v1 = this.getCellSortValue(c1);\n\t\t\t\tlet v2 = this.getCellSortValue(c2);\n\n\t\t\t\tif (this.direction === \"ascending\") {\n\t\t\t\t\tif (v1 < v2) return -1;\n\t\t\t\t\tif (v1 > v2) return 1;\n\t\t\t\t} else {\n\t\t\t\t\tif (v1 < v2) return 1;\n\t\t\t\t\tif (v1 > v2) return -1;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t});\n\n\t\t\t// Remove \"sorted\" and direction classes from all th and add for sorted column\n\t\t\tthis.ths.forEach((th) => {\n\t\t\t\tth.classList.remove(\"sort-ascending\");\n\t\t\t\tth.classList.remove(\"sort-descending\");\n\t\t\t\tif (th.textContent?.trim().toLowerCase() === sort) {\n\t\t\t\t\tth.classList.add(`sort-${direction}`);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.rowsArray.forEach((row) => this.tbody.appendChild(row));\n\t\t}\n\t}\n}\n\ncustomElements.define(\"action-table\", ActionTable);\n"],"names":["ActionTable","__publicField","_a","value","table","rows","th","_b","name","span","oldValue","newValue","event","el","col","filterMenus","c","row","cells","content","filterArray","regexString","i","cell","cellContent","sort","direction","column_index","r1","r2","c1","c2","v1","v2"],"mappings":"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"}