var b=Object.defineProperty;var p=(d,c,t)=>c in d?b(d,c,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[c]=t;var a=(d,c,t)=>(p(d,typeof c!="symbol"?c+"":c,t),t);class m extends HTMLElement{constructor(){super();a(this,"tbody");a(this,"thead");a(this,"tfoot");a(this,"ths");a(this,"cols",[]);a(this,"filters",{});a(this,"rowsArray");a(this,"ready",!1);a(this,"colGroupCols");a(this,"rowsShown",0);this.direction="ascending",this.addEventListeners()}static get observedAttributes(){return["sort","direction","page","pagination"]}get sort(){var t;return((t=this.getAttribute("sort"))==null?void 0:t.trim().toLowerCase())||""}set sort(t){this.setAttribute("sort",t)}get direction(){var i;const t=(i=this.getAttribute("direction"))==null?void 0:i.trim().toLowerCase();return t==="ascending"||t==="descending"?t:"ascending"}set direction(t){this.setAttribute("direction",t)}get store(){return this.hasAttribute("store")}get URLparams(){return this.hasAttribute("urlparams")}get id(){return this.getAttribute("id")||""}get pagination(){return Number(this.getAttribute("pagination"))||0}set pagination(t){this.setAttribute("pagination",t.toString())}get page(){return Number(this.getAttribute("page"))||1}set page(t){this.setAttribute("page",t.toString())}connectedCallback(){this.init()}async init(){if(this.getTable(),await this.waitForCustomElements(this),this.getTableContent(),this.addObserver(this.tbody),this.addNoResultsTfoot(),this.getLocalStorage(),this.getURLParams(),this.pagination>0){const t=document.querySelector("action-table-pagination");t&&(t.pagination=this.pagination)}this.ready=!0,this.initialFilter()}attributeChangedCallback(t,i,s){i!==s&&this.ready&&((t==="sort"||t==="direction")&&this.sortTable(),t==="page"&&this.appendRows())}async initialFilter(){const t=await this.waitForCustomElements();if(Object.keys(this.filters).length>0&&this.filterTable(),this.sortTable(),this.rowsShown===0&&this.resetFilters(),t.length>0){const i=t.find(s=>s.tagName.toLowerCase()==="action-table-filters");i&&i.setFilterElements(this.filters)}}async waitForCustomElements(t=this){const i=Array.from(t.querySelectorAll("*")).filter(o=>o.tagName.indexOf("-")!==-1);if(i.every(o=>o&&customElements.get(o.tagName.toLowerCase())))return i;const e=i.map(o=>customElements.whenDefined(o.tagName.toLowerCase())),r=new Promise((o,n)=>setTimeout(()=>n("Timeout"),300));try{return await Promise.race([Promise.all(e),r]),i}catch{return[]}}setFilter(t,i,s=!1){const e=this.filters;this.doesColumnExist(t)&&(e[t]=e[t]||{},e[t].values=i,s&&(e[t].exclusive=s),this.filters=e,this.setFiltersLocalStorage())}doesColumnExist(t){return this.cols.includes(t)||t==="action-table"}getLocalStorage(){if(!this.store)return;const t=localStorage.getItem(`action-table${this.id?`-${this.id}`:""}`);if(t){const s=JSON.parse(t);this.sort=s.sort,this.direction=s.direction}const i=localStorage.getItem(`action-table-filters${this.id?`-${this.id}`:""}`);i&&(this.filters=JSON.parse(i))}setFiltersLocalStorage(){this.store&&localStorage.setItem(`action-table-filters${this.id?`-${this.id}`:""}`,JSON.stringify(this.filters))}getURLParams(){if(!this.URLparams)return;const t=new URLSearchParams(window.location.search);if(t.size===0)return;this.sort=t.get("sort")||this.sort;const i=t.get("direction");(i==="ascending"||i==="descending")&&(this.direction=i);const s={};for(const[e,r]of t.entries())e!=="sort"&&e!=="direction"&&this.doesColumnExist(e)&&(s[e]=s[e]||{},s[e].values=[r]);Object.keys(s).length>0&&(this.filters=s)}addEventListeners(){this.addEventListener("click",t=>{const i=t.target;if(i.tagName==="BUTTON"&&i.dataset.col){const s=i.dataset.col;let e="ascending";this.sort===s&&this.direction==="ascending"&&(e="descending"),this.sort=s,this.direction=e,this.store&&localStorage.setItem(`action-table${this.id?`-${this.id}`:""}`,JSON.stringify({sort:this.sort,direction:e}))}},!1),this.addEventListener("change",t=>{const i=t.target;i.closest("td")&&i.type==="checkbox"&&this.getContentSortAndFilter()})}getContentSortAndFilter(){this.getTableContent(),this.filterTable(),this.sortTable()}getTable(){const t=this.querySelector("table");this.thead=t.querySelector("thead"),this.tbody=t.querySelector("tbody");const i=this.tbody.querySelectorAll("tbody tr");this.rowsArray=Array.from(i),this.getColumns(t)}getColumns(t){if(this.ths=t.querySelectorAll("th"),this.ths&&this.ths.forEach(s=>{let e=s.dataset.col||this.getCellContent(s);e=e.trim().toLowerCase(),e&&(this.cols.push(e),s.dataset.col=e,s.hasAttribute("no-sort")||(s.innerHTML=`<button data-col="${e}">${s.innerHTML}</button>`))}),!t.querySelector("colgroup")){const s=document.createElement("colgroup");this.cols.forEach(()=>{const e=document.createElement("col");s.appendChild(e)}),t.prepend(s)}return this.colGroupCols=this.querySelectorAll("col"),this.cols}addNoResultsTfoot(){const t=document.createElement("tfoot");t.classList.add("no-results"),t.innerHTML=`<tr><td colspan="${this.cols.length}"><p>No Results</p> <p><button>Reset Filters</button></p></td></tr>`,t.addEventListener("click",i=>{if(i.target.tagName!=="BUTTON")return;this.resetFilters();const e=this.querySelector("action-table-filters");e&&e.resetAllFilterElements()}),t.style.display="none",this.tfoot=t,this.tbody.after(this.tfoot)}getCellContent(t){var s;let i=(t==null?void 0:t.innerText)||"";if(i=i==null?void 0:i.trim(),!i){const e=t.querySelector("svg");e&&(i=((s=e.querySelector("title"))==null?void 0:s.textContent)||"");const r=t.querySelector("[type=checkbox]");r!=null&&r.checked&&(i=r.value)}return i.trim()}getTableContent(){this.rowsArray.forEach(t=>{const i=t.querySelectorAll("td");this.cols.forEach((s,e)=>{const r=i[e],o=this.getCellContent(r);r.actionTable={col:s,sort:r.dataset.sort||o,filter:r.dataset.filter||o}})})}addObserver(t){new MutationObserver(s=>{s.forEach(e=>{const r=e.target;(r instanceof HTMLTableCellElement||r instanceof HTMLSpanElement||r instanceof HTMLLIElement)&&this.getContentSortAndFilter()})}).observe(t,{childList:!0,subtree:!0,attributes:!0})}resetFilters(){this.filters={},this.setFiltersLocalStorage(),this.filterTable()}filterTable(t="",i=[],s=!1,e="i"){t=t.trim().toLowerCase(),this.doesColumnExist(t)&&this.setFilter(t,i,s);const r=this.filters["action-table"];this.rowsArray.forEach(o=>{let n=!1;const h=o.querySelectorAll("td");if(r){const u=Array.from(h).map(l=>l.actionTable.filter).join(" ");this.shouldHide(r,u,e)&&(n=!0)}h.forEach((u,l)=>{const f=u.actionTable.filter,g=this.filters[this.cols[l]];g&&this.shouldHide(g,f,e)&&(n=!0)}),o.hideRow=n}),this.appendRows(this.rowsArray)}shouldHide(t,i,s){if(t.values&&t.values.length>0){let e=t.values.join("|");if(t.exclusive&&(e=`${t.values.map(n=>`(?=.*${n})`).join("")}.*`),!new RegExp(e,s).test(i))return!0}return!1}sortTable(t=this.sort,i=this.direction){t=t.toLowerCase();const s=this.cols.findIndex(e=>e===t);if(s>=0&&this.rowsArray.length>0){const e=this.customSort(this.rowsArray,s);this.colGroupCols.forEach((r,o)=>{o===s?r.classList.add("sorted"):r.classList.remove("sorted")}),this.ths.forEach((r,o)=>{const n=o===s?i:"none";r.setAttribute("aria-sort",n)}),this.appendRows(e)}}customSort(t,i){return t.sort((s,e)=>{if(this.direction==="descending"){const l=s;s=e,e=l}const r=s.children[i],o=e.children[i],n=r.actionTable.sort,h=o.actionTable.sort;function u(l){return!isNaN(Number(l))}if(u(n)&&u(h)){const l=Number(n),f=Number(h);if(l<f)return-1;if(l>f)return 1}return typeof n=="string"&&typeof h=="string"?n.localeCompare(h):0})}isActivePage(t){const i=this.pagination;if(i===0)return!0;const s=i*(this.page-1)+1,e=i*this.page;return t+1>s&&t<=e}appendRows(t=this.rowsArray){const i=document.createDocumentFragment();let s=0;if(t.forEach(e=>{e.hideRow||s++,e.hideRow||!this.isActivePage(s)?e.style.display="none":(e.style.display="",i.appendChild(e))}),this.tfoot.style.display=s===0?"table-footer-group":"none",this.tbody.prepend(i),this.pagination>0){let e=this.page;s<this.rowsShown&&(e=Math.ceil(s/this.pagination)),s<1&&(e=1);const r=document.querySelector("action-table-pagination");if(r){const o={};this.page!==e&&(o.page=e),this.rowsShown!==s&&(o.rowsShown=s),Object.keys(o).length>0&&r.setProps(o)}this.page=e}this.rowsShown=s}}customElements.define("action-table",m);
//# sourceMappingURL=action-table.js.map
