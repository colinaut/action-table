var p=Object.defineProperty;var m=(c,a,t)=>a in c?p(c,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[a]=t;var h=(c,a,t)=>(m(c,typeof a!="symbol"?a+"":a,t),t);class y extends HTMLElement{constructor(){super();const a=this.closest("action-table"),{rowsVisible:t}=a;t===0?this.style.display="":this.style.display="none",this.addEventListener("click",e=>{e.target instanceof HTMLButtonElement&&e.target.type==="reset"&&(this.dispatchEvent(new CustomEvent("action-table-filter",{bubbles:!0})),this.dispatchEvent(new CustomEvent("action-table-filters-reset",{bubbles:!0})))}),a.addEventListener("action-table",e=>{const s=e.detail;(s==null?void 0:s.rowsVisible)===0?this.style.display="":this.style.display="none"})}}customElements.define("action-table-no-results",y);const d="action-table";class C extends HTMLElement{constructor(){var t;super();h(this,"table");h(this,"tbody");h(this,"cols",[]);h(this,"rows",[]);h(this,"filters",{});h(this,"sortAndFilter",this.delayUntilNoLongerCalled(()=>{this.filterTable(),this.sortTable(),this.appendRows(),this.tbody.matches("[style*=none]")&&(this.rowsVisible===0&&(this.setFilters(),this.dispatchEvent(new Event(`${d}-filters-reset`))),this.tbody.style.display="")}));if(this.store){const e=this.getStore();e&&(this.sort=e.sort||this.sort,this.direction=e.direction||this.direction,this.filters=e.filters||this.filters)}if(this.hasAttribute("urlparams")){const e=new URLSearchParams(window.location.search),s={};for(let[i,r]of e.entries())i=i.toLowerCase(),r=r.toLowerCase(),i!=="sort"&&i!=="direction"&&((t=s[i])!=null&&t.values?s[i].values.push(r):s[i]={values:[r]}),i==="sort"&&(this.sort=r),i==="direction"&&(r==="ascending"||r==="descending")&&(this.direction=r);Object.keys(s).length>0&&this.setFiltersObject(s)}this.addEventListeners()}get sort(){return this.getCleanAttr("sort")}set sort(t){this.setAttribute("sort",t)}get direction(){const t=this.getCleanAttr("direction");return t==="ascending"||t==="descending"?t:"ascending"}set direction(t){this.setAttribute("direction",t)}get store(){return this.hasAttribute("store")}get id(){return this.getCleanAttr("id")}get pagination(){return Number(this.getCleanAttr("pagination"))||0}set pagination(t){this.setAttribute("pagination",t.toString())}get page(){return Number(this.getCleanAttr("page"))||1}set page(t){t=this.checkPage(t),this.setAttribute("page",t.toString())}checkPage(t){return Math.max(1,Math.min(t,this.numberOfPages))}dispatch(t){this.dispatchEvent(new CustomEvent("action-table",{detail:t}))}getCleanAttr(t){var e;return((e=this.getAttribute(t))==null?void 0:e.trim().toLowerCase())||""}connectedCallback(){const t=this.querySelector("table");if(t&&t.querySelector("thead tr th")&&t.querySelector("tbody tr td"))this.table=t,this.tbody=t.querySelector("tbody"),this.rows=Array.from(t.querySelectorAll("tbody tr"));else throw new Error("Could not find table with thead and tbody in action-table");const e=Object.keys(this.filters).length>0;!e&&!this.sort?this.appendRows():this.tbody.style.display="none",this.getColumns(),this.getTableContent(),(e||this.sort)&&(Object.keys(this.filters).forEach(s=>{this.cols.some(i=>i.name===s)||delete this.filters[s]}),this.sortAndFilter()),this.addObserver()}static get observedAttributes(){return["sort","direction","pagination","page"]}attributeChangedCallback(t,e,s){e!==s&&this.rows.length>0&&((t==="sort"||t==="direction")&&this.sortTable(),t==="pagination"&&this.dispatch({pagination:this.pagination}),this.appendRows())}setFiltersObject(t={}){this.filters=t,this.store&&this.setStore({filters:this.filters})}setFilters(t={}){this.setFiltersObject(t),this.filterTable(),this.appendRows()}addEventListeners(){this.addEventListener("click",t=>{const e=t.target;if(e instanceof HTMLButtonElement&&e.dataset.col){const s=e.dataset.col;let i="ascending";this.sort===s&&this.direction==="ascending"&&(i="descending"),this.sort=s,this.direction=i,this.store&&this.setStore({sort:this.sort,direction:i})}},!1),this.addEventListener("change",t=>{const e=t.target;e instanceof HTMLInputElement&&e.closest("td")&&e.type==="checkbox"&&this.updateContent(e)}),this.addEventListener(`${d}-filter`,t=>{if(t.detail){const e={...this.filters,...t.detail};Object.keys(e).forEach(s=>{e[s].values.every(i=>i==="")&&delete e[s]}),this.setFilters(e)}else this.setFilters()}),this.addEventListener(`${d}-update`,t=>{const e=t.target;e instanceof Element&&this.updateContent(e,t.detail)})}getStore(){try{const t=localStorage.getItem(`${d}-${this.id}`),e=t&&JSON.parse(t);return typeof e=="object"&&e!==null&&["sort","direction","filters"].some(i=>i in e)?e:!1}catch{return!1}}setStore(t){const e=this.getStore()||{};e&&(t={...e,...t}),localStorage.setItem(`${d}-${this.id}`,JSON.stringify(t))}updateContent(t,e={}){const s=t.matches("td")?t:t.closest("td");s&&(e=typeof e=="string"?{sort:e,filter:e}:e,this.setCellContent(s,e),this.sortAndFilter())}delayUntilNoLongerCalled(t){let e,s=!1;function i(){t(),s=!1}return function(){s?clearTimeout(e):s=!0,e=setTimeout(i,10)}}getColumns(){const t=this.table.querySelectorAll("thead th");if(t.forEach(e=>{const s=(e.dataset.col||this.getCellContent(e)).trim().toLowerCase(),i=e.dataset.order?e.dataset.order.split(","):void 0;if(this.cols.push({name:s,order:i}),!e.hasAttribute("no-sort")){const r=document.createElement("button");r.dataset.col=s,r.type="button",r.innerHTML=e.innerHTML,e.replaceChildren(r)}}),!this.table.querySelector("colgroup")){const e=document.createElement("colgroup");t.forEach(()=>{const s=document.createElement("col");e.appendChild(s)}),this.table.prepend(e)}}getCellContent(t){var s;let e=(t.textContent||"").trim();if(!e){const i=t.querySelector("svg");i instanceof SVGElement&&(e=((s=i.querySelector("title"))==null?void 0:s.textContent)||e);const r=t.querySelector("input[type=checkbox]");r instanceof HTMLInputElement&&r.checked&&(e=r.value,"actionTable"in t&&(t.actionTable={...t.actionTable,checked:!0}));const n=t.querySelector(":defined");n!=null&&n.shadowRoot&&(e=n.shadowRoot.textContent||e)}return e.trim()}getTableContent(){this.rows.forEach(t=>{t.querySelectorAll("td").forEach((s,i)=>{const r=this.cols[i];this.setCellContent(s,{col:r.name})})})}setCellContent(t,e={}){const s=this.getCellContent(t);t.actionTable={...t.actionTable,sort:t.dataset.sort||s,filter:t.dataset.filter||s,...e}}addObserver(){new MutationObserver(e=>{e.forEach(s=>{let i=s.target;if(i.nodeType===3&&i.parentNode&&(i=i.parentNode),!(i instanceof HTMLElement))return;const r=i.closest("td");if(r instanceof HTMLTableCellElement)if(r.hasAttribute("contenteditable")&&r===document.activeElement){const n=()=>this.updateContent(r);r.removeEventListener("blur",n),r.addEventListener("blur",n)}else this.updateContent(r)})}).observe(this.tbody,{childList:!0,subtree:!0,attributes:!0,characterData:!0,attributeFilter:["data-sort","data-filter"]})}filterTable(){const t=this.numberOfPages,e=this.rowsVisible,s=this.filters["action-table"];this.rows.forEach(i=>{let r=!1;const n=i.querySelectorAll("td");if(s){const u=Array.from(n).map(o=>o.actionTable.checked?"":o.actionTable.filter).join(" ");this.shouldHide(s,u)&&(r=!0)}n.forEach((u,o)=>{const l=this.filters[this.cols[o].name];l&&this.shouldHide(l,u.actionTable.filter)&&(r=!0)}),i.hideRow=r}),this.numberOfPages!==t&&this.dispatch({numberOfPages:this.numberOfPages}),this.rowsVisible!==e&&this.dispatch({rowsVisible:this.rowsVisible})}shouldHide(t,e){if(t.values&&t.values.length>0){if(t.regex){let s=t.values.join("|");return t.exclusive&&(s=`${t.values.map(n=>`(?=.*${n})`).join("")}.*`),!new RegExp(s,"i").test(e)}if(t.range){const[s,i]=t.values;if(!isNaN(Number(s))&&!isNaN(Number(i)))return Number(e)<Number(s)||Number(e)>Number(i)}return t.exclusive?!t.values.every(s=>e.toLowerCase().includes(s.toLowerCase())):t.exact?t.values.every(s=>s&&s!==e):!t.values.some(s=>e.toLowerCase().includes(s.toLowerCase()))}return!1}sortTable(t=this.sort,e=this.direction){t=t.toLowerCase();const s=this.cols.findIndex(i=>i.name===t);if(s>=0&&this.rows.length>0){const i=this.cols[s].order,r=o=>i!=null&&i.includes(o)?i.indexOf(o).toString():o;this.rows.sort((o,l)=>{if(this.direction==="descending"){const g=o;o=l,l=g}const f=r(o.children[s].actionTable.sort),b=r(l.children[s].actionTable.sort);return this.alphaNumSort(f,b)}),this.querySelectorAll("col").forEach((o,l)=>{l===s?o.classList.add("sorted"):o.classList.remove("sorted")}),this.table.querySelectorAll("thead th").forEach((o,l)=>{const f=l===s?e:"none";o.setAttribute("aria-sort",f)})}}alphaNumSort(t,e){function s(n){if(isNaN(Number(n))){if(!isNaN(Date.parse(n)))return Date.parse(n)}else return Number(n)}const i=s(t),r=s(e);return i&&r?i-r:t.localeCompare(e)}appendRows(){const t=i=>{const{pagination:r,page:n}=this;return r===0||i>=r*(n-1)+1&&i<=r*n},e=document.createDocumentFragment();let s=0;if(this.rows.forEach(i=>{let r="none";i.hideRow||(s++,t(s)&&(r="",e.appendChild(i))),i.style.display=r}),this.tbody.prepend(e),this.pagination>0){const i=this.checkPage(this.page);i!==this.page&&(this.page=i,this.dispatch({page:i}))}}get rowsVisible(){return this.rows.filter(t=>!t.hideRow).length}get numberOfPages(){return this.pagination>0?Math.ceil(this.rowsVisible/this.pagination):1}}customElements.define("action-table",C);
//# sourceMappingURL=action-table.js.map
