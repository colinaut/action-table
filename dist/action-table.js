var y=Object.defineProperty;var m=(h,l,t)=>l in h?y(h,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[l]=t;var c=(h,l,t)=>(m(h,typeof l!="symbol"?l+"":l,t),t);class T extends HTMLElement{constructor(){super();c(this,"tbody");c(this,"tfoot");c(this,"ths");c(this,"cols",[]);c(this,"filters",{});c(this,"rowsArray")}static get observedAttributes(){return["sort","direction","store","params"]}get sort(){var t;return((t=this.getAttribute("sort"))==null?void 0:t.trim().toLowerCase())||""}set sort(t){this.setAttribute("sort",t)}get direction(){var e;const t=(e=this.getAttribute("direction"))==null?void 0:e.trim().toLowerCase();return t==="ascending"||t==="descending"?t:"ascending"}set direction(t){this.setAttribute("direction",t)}get store(){return this.hasAttribute("store")}get URLparams(){return this.hasAttribute("urlparams")}connectedCallback(){this.getLocalStorage(),this.getURLParams(),this.getTable(),this.addNoResultsTfoot(),this.sort&&this.sortTable(),Object.keys(this.filters).length>0&&this.initialFilter(),this.rowsShown.length===0&&(this.resetFilters(),this.resetAllFilterElements()),this.addEventListeners()}async checkForActionTableFilters(){const t="action-table-filters",e=this.querySelector(t);if(e)return await customElements.whenDefined(t),e}async initialFilter(){this.filterTable();const t=await this.checkForActionTableFilters();t&&t.setFilterElements(this.filters)}attributeChangedCallback(t){(t==="sort"||t==="direction")&&this.sortTable()}getLocalStorage(){if(!this.store)return;const t=localStorage.getItem("action-table");if(t){const s=JSON.parse(t);this.sort=s.sort,this.direction=s.direction}const e=localStorage.getItem("action-table-filters");e&&(this.filters=JSON.parse(e))}getURLParams(){if(!this.URLparams)return;const t=new URLSearchParams(window.location.search);if(t.size===0)return;this.sort=t.get("sort")||this.sort;const e=t.get("direction");(e==="ascending"||e==="descending")&&(this.direction=e);const s={};for(const[i,n]of t.entries())i!=="sort"&&i!=="direction"&&(s[i]=n);Object.keys(s).length>0&&(this.filters=s)}getTable(){const t=this.querySelector("table");this.tbody=t.querySelector("tbody");const e=this.tbody.querySelectorAll("tbody tr");this.rowsArray=Array.from(e),this.getColumns(t)}getColumns(t){return this.ths=t.querySelectorAll("th"),this.ths&&this.ths.forEach(e=>{let s=e.dataset.col||e.innerText||"";s=s.trim().toLowerCase(),s&&(this.cols.push({name:s}),e.hasAttribute("no-sort")||(e.innerHTML=`<button data-col="${s}">${e.innerHTML}</button>`))}),this.cols}addNoResultsTfoot(){const t=document.createElement("tfoot");t.classList.add("no-results"),t.innerHTML=`<tr><td colspan="${this.cols.length}"><p>No Results</p> <p><button>Reset Filters</button></p></td></tr>`,t.addEventListener("click",e=>{e.target.tagName==="BUTTON"&&(this.resetFilters(),this.resetAllFilterElements(),this.showTfoot(!1))}),this.tfoot=t,this.showTfoot(!1),this.tbody.after(this.tfoot)}showTfoot(t=!0){this.tfoot&&(this.tfoot.style.display=t?"table-footer-group":"none")}async resetAllFilterElements(){const t=await this.checkForActionTableFilters();t&&t.resetAllFilterElements()}addEventListeners(){this.addEventListener("click",t=>{const e=t.target;if(e.tagName==="BUTTON"){if(e.dataset.sortable==="false")return;let s=e.dataset.col;s&&(this.sort===s&&this.direction==="ascending"?this.direction="descending":(this.sort=s,this.direction="ascending"),this.sortTable(),this.store&&localStorage.setItem("action-table",JSON.stringify({sort:this.sort,direction:this.direction})))}},!1)}setFiltersLocalStorage(){this.store&&localStorage.setItem("action-table-filters",JSON.stringify(this.filters))}resetFilters(){this.filters={},this.setFiltersLocalStorage(),this.filterTable(),this.showTfoot(!1)}filterTable(t="",e="",s=!1,i="i"){t=t.trim().toLowerCase(),t!==""&&(this.filters[t]=e,this.setFiltersLocalStorage());function n(r,o){if(typeof r=="string"){if(!new RegExp(r,i).test(o))return!0}else if(Array.isArray(r)&&r.length>0){let a=r.join("|");if(s&&(a=`${r.map(g=>`(?=.*${g})`).join("")}.*`),!new RegExp(a).test(o))return!0}return!1}const d=this.filters["action-table"];this.rowsArray.forEach(r=>{let o="";const a=r.querySelectorAll("td");d&&n(d,r.innerText)&&(o="none"),a.forEach((f,u)=>{const g=this.dataset.filter||this.getCellContent(f);let b=this.filters[this.cols[u].name];b&&n(b,g)&&(o="none")}),r.style.display=o}),this.rowsShown.length===0?this.showTfoot():this.showTfoot(!1)}get rowsShown(){return this.rowsArray.filter(t=>t.style.display!=="none")}getCellContent(t){var s;let e=t.dataset.sort||t.innerText||"";if(e=e==null?void 0:e.trim(),!e){const i=t.firstElementChild;if(i.tagName.toLowerCase()==="svg"&&(e=((s=i.querySelector("title"))==null?void 0:s.textContent)||""),i.tagName.toLowerCase()==="action-table-switch"){const n=i;e=n.checked||n.hasAttribute("checked")?"on":""}if(i.tagName.toLowerCase()==="input"){const n=i;e=n.checked?n.value:""}}return e.trim()}sortTable(t=this.sort,e=this.direction){t=t.toLowerCase();const s=this.cols.findIndex(i=>i.name===t);s>=0&&this.rowsArray.length>0&&(this.customSort(this.rowsArray,s),this.rowsArray.forEach((i,n)=>{this.tbody.appendChild(i),n<1&&this.ths.forEach((r,o)=>{const a=o===s?e:"none";r.setAttribute("aria-sort",a)}),i.querySelectorAll("td").forEach((r,o)=>{o===s?r.classList.add("sorted"):r.classList.remove("sorted")})}))}customSort(t,e){return t.sort((s,i)=>{if(this.direction==="descending"){const f=s;s=i,i=f}const n=s.children[e],d=i.children[e];let r=this.getCellContent(n),o=this.getCellContent(d);function a(f){return!isNaN(parseFloat(f))}return a(r)&&a(o)?parseFloat(r)-parseFloat(o):a(r)?-1:a(o)?1:r.localeCompare(o)})}}customElements.define("action-table",T);
//# sourceMappingURL=action-table.js.map
