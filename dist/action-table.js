var b=Object.defineProperty;var p=(u,d,t)=>d in u?b(u,d,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[d]=t;var h=(u,d,t)=>(p(u,typeof d!="symbol"?d+"":d,t),t);class m extends HTMLElement{constructor(){super();h(this,"tbody");h(this,"thead");h(this,"tfoot");h(this,"cols",[]);h(this,"filters",{});h(this,"rowsArray");h(this,"ready",!1);h(this,"colGroupCols");h(this,"rowsShown",0);this.page=1,this.addEventListeners()}static get observedAttributes(){return["sort","direction","page","pagination"]}get sort(){var t;return((t=this.getAttribute("sort"))==null?void 0:t.trim().toLowerCase())||""}set sort(t){this.setAttribute("sort",t)}get direction(){var e;const t=(e=this.getAttribute("direction"))==null?void 0:e.trim().toLowerCase();return t==="ascending"||t==="descending"?t:"ascending"}set direction(t){this.setAttribute("direction",t)}get store(){return this.hasAttribute("store")}get URLparams(){return this.hasAttribute("urlparams")}get id(){return this.getAttribute("id")||""}get pagination(){return Number(this.getAttribute("pagination"))||0}set pagination(t){this.setAttribute("pagination",t.toString())}get page(){return Number(this.getAttribute("page"))||1}set page(t){this.setAttribute("page",t.toString())}connectedCallback(){this.init()}async init(){this.getTable();const t=this.querySelector("tbody");t&&Array.from(t.querySelectorAll("*")).filter(i=>i.tagName.indexOf("-")!==-1).length>0&&await this.waitForCustomElements(t),this.getTableContent(),this.addObserver(this.tbody),this.addNoResultsTfoot(),this.getLocalStorage(),this.getURLParams(),this.initialFilter()}attributeChangedCallback(t,e,i){e!==i&&this.ready&&((t==="sort"||t==="direction")&&this.sortTable(),t==="page"&&this.appendRows())}async initialFilter(){Object.keys(this.filters).length>0&&this.filterTable(),this.sort&&this.sortTable(),this.appendRows(),this.ready=!0,this.rowsShown===0&&this.resetFilters();const t=this.querySelector("action-table-filters");t&&this.setFilterElements(t)}async setFilterElements(t){await customElements.whenDefined("action-table-filters"),t.setFilterElements(this.filters)}async waitForCustomElements(t=this){const e=Array.from(t.querySelectorAll("*")).filter(r=>r.tagName.indexOf("-")!==-1);if(e.length===0)return[];if(e.every(r=>r&&customElements.get(r.tagName.toLowerCase())))return e;const s=e.map(r=>customElements.whenDefined(r.tagName.toLowerCase())),o=new Promise((r,n)=>setTimeout(()=>n("Timeout"),300));try{return await Promise.race([Promise.all(s),o]),e}catch{return[]}}setFilter(t,e,i=!1){const s=this.filters;this.doesColumnExist(t)&&(s[t]=s[t]||{},s[t].values=e,i&&(s[t].exclusive=i),this.filters=s,this.setFiltersLocalStorage())}doesColumnExist(t){return this.cols.includes(t)||t==="action-table"}getLocalStorage(){if(!this.store)return;const t=localStorage.getItem(`action-table${this.id?`-${this.id}`:""}`);if(t){const i=JSON.parse(t);this.sort=i.sort,this.direction=i.direction}const e=localStorage.getItem(`action-table-filters${this.id?`-${this.id}`:""}`);e&&(this.filters=JSON.parse(e))}setFiltersLocalStorage(){this.store&&localStorage.setItem(`action-table-filters${this.id?`-${this.id}`:""}`,JSON.stringify(this.filters))}getURLParams(){if(!this.URLparams)return;const t=new URLSearchParams(window.location.search);if(t.size===0)return;this.sort=t.get("sort")||this.sort;const e=t.get("direction");(e==="ascending"||e==="descending")&&(this.direction=e);const i={};for(const[s,o]of t.entries())s!=="sort"&&s!=="direction"&&this.doesColumnExist(s)&&(i[s]=i[s]||{},i[s].values=[o]);Object.keys(i).length>0&&(this.filters=i)}addEventListeners(){this.addEventListener("click",t=>{const e=t.target;if(e.tagName==="BUTTON"&&e.dataset.col){const i=e.dataset.col;let s="ascending";this.sort===i&&this.direction==="ascending"&&(s="descending"),this.sort=i,this.direction=s,this.store&&localStorage.setItem(`action-table${this.id?`-${this.id}`:""}`,JSON.stringify({sort:this.sort,direction:s}))}},!1),this.addEventListener("change",t=>{const e=t.target;e.closest("td")&&e.type==="checkbox"&&this.getContentSortAndFilter()})}getContentSortAndFilter(){this.getTableContent(),this.filterTable(),this.sortTable()}getTable(){const t=this.querySelector("table");this.thead=t.querySelector("thead"),this.tbody=t.querySelector("tbody");const e=this.tbody.querySelectorAll("tbody tr");this.rowsArray=Array.from(e),this.rowsShown=this.rowsArray.length,this.getColumns(t)}getColumns(t){const e=t.querySelectorAll("th"),i=t.querySelector("thead tr"),s=document.createDocumentFragment();if(e&&e.forEach(r=>{let n=r.dataset.col||this.getCellContent(r);if(n=n.trim().toLowerCase(),n)if(this.cols.push(n),r.dataset.col=n,r.hasAttribute("no-sort"))s.appendChild(r);else{const a=r.cloneNode(),l=document.createElement("button");l.dataset.col=n,l.innerHTML=r.innerHTML,a.appendChild(l),s.appendChild(a)}}),i==null||i.replaceChildren(s),!t.querySelector("colgroup")){const r=document.createElement("colgroup");this.cols.forEach(()=>{const n=document.createElement("col");r.appendChild(n)}),t.prepend(r)}return this.colGroupCols=this.querySelectorAll("col"),this.cols}addNoResultsTfoot(){const t=document.createElement("tfoot");t.classList.add("no-results"),t.innerHTML=`<tr><td colspan="${this.cols.length}"><p>No Results</p> <p><button>Reset Filters</button></p></td></tr>`,t.addEventListener("click",e=>{if(e.target.tagName!=="BUTTON")return;this.resetFilters();const s=this.querySelector("action-table-filters");s&&s.resetAllFilterElements()}),t.style.display="none",this.tfoot=t,this.tbody.after(this.tfoot)}getCellContent(t){var i;let e=(t==null?void 0:t.textContent)||"";if(e=e==null?void 0:e.trim(),!e){const s=t.querySelector("svg");s&&(e=((i=s.querySelector("title"))==null?void 0:i.textContent)||"");const o=t.querySelector("[type=checkbox]");o!=null&&o.checked&&(e=o.value)}return e.trim()}getTableContent(){this.rowsArray.forEach(t=>{const e=t.querySelectorAll("td");this.cols.forEach((i,s)=>{const o=e[s],r=this.getCellContent(o);o.actionTable={col:i,sort:o.dataset.sort||r,filter:o.dataset.filter||r}})})}addObserver(t){new MutationObserver(i=>{i.forEach(s=>{const o=s.target;(o instanceof HTMLTableCellElement||o instanceof HTMLSpanElement||o instanceof HTMLLIElement)&&this.getContentSortAndFilter()})}).observe(t,{childList:!0,subtree:!0,attributes:!0})}resetFilters(){this.filters={},this.setFiltersLocalStorage(),this.filterTable()}filterTable(t="",e=[],i=!1,s="i"){t=t.trim().toLowerCase(),this.doesColumnExist(t)&&this.setFilter(t,e,i);const o=this.filters["action-table"];this.rowsArray.forEach(r=>{let n=!1;const a=r.querySelectorAll("td");if(o){const l=Array.from(a).map(c=>c.actionTable.filter).join(" ");this.shouldHide(o,l,s)&&(n=!0)}a.forEach((l,c)=>{const f=l.actionTable.filter,g=this.filters[this.cols[c]];g&&this.shouldHide(g,f,s)&&(n=!0)}),r.hideRow=n}),this.ready&&this.appendRows(this.rowsArray)}shouldHide(t,e,i){if(t.values&&t.values.length>0){let s=t.values.join("|");if(t.exclusive&&(s=`${t.values.map(n=>`(?=.*${n})`).join("")}.*`),!new RegExp(s,i).test(e))return!0}return!1}sortTable(t=this.sort,e=this.direction){t=t.toLowerCase();const i=this.cols.findIndex(s=>s===t);if(i>=0&&this.rowsArray.length>0){const s=this.customSort(this.rowsArray,i);this.colGroupCols.forEach((r,n)=>{n===i?r.classList.add("sorted"):r.classList.remove("sorted")}),this.thead.querySelectorAll("th").forEach((r,n)=>{const a=n===i?e:"none";r.setAttribute("aria-sort",a)}),this.ready&&this.appendRows(s)}}customSort(t,e){return t.sort((i,s)=>{if(this.direction==="descending"){const c=i;i=s,s=c}const o=i.children[e],r=s.children[e],n=o.actionTable.sort,a=r.actionTable.sort;function l(c){return!isNaN(Number(c))}if(l(n)&&l(a)){const c=Number(n),f=Number(a);if(c<f)return-1;if(c>f)return 1}return typeof n=="string"&&typeof a=="string"?n.localeCompare(a):0})}isActivePage(t){const e=this.pagination;if(e===0)return!0;const i=e*(this.page-1)+1,s=e*this.page;return t+1>i&&t<=s}appendRows(t=this.rowsArray){const e=document.createDocumentFragment();let i=0;if(t.forEach(s=>{s.hideRow||i++,s.hideRow||!this.isActivePage(i)?s.style.display="none":(s.style.display="",e.appendChild(s))}),this.tfoot.style.display=i===0?"table-footer-group":"none",this.tbody.prepend(e),this.pagination>0){let s=this.page;const o=Math.ceil(i/this.pagination);s>o&&(s=o||1);const r=document.querySelector("action-table-pagination");r&&this.setPaginationElement(r,this.page,s,this.rowsShown,i),this.page=s}this.rowsShown=i}async setPaginationElement(t,e,i,s,o){await customElements.whenDefined("action-table-pagination");const r={};e!==i&&(r.page=i),s!==o&&(r.rowsShown=o),Object.keys(r).length>0&&t.setProps(r)}}customElements.define("action-table",m);
//# sourceMappingURL=action-table.js.map
