var x=Object.defineProperty;var y=(f,m,e)=>m in f?x(f,m,{enumerable:!0,configurable:!0,writable:!0,value:e}):f[m]=e;var b=(f,m,e)=>(y(f,typeof m!="symbol"?m+"":m,e),e);class A extends HTMLElement{constructor(){super();b(this,"options",[])}findOptions(e){e=e.toLowerCase();const t=this.closest("action-table"),i=t.cols,n=t.tbody,u=i.findIndex(s=>s.name===e);if(u===-1)return;const c=`td:nth-child(${u+1})`,h=n.querySelectorAll(c);let a=[];Array.from(h).forEach(s=>{const o=s.querySelectorAll("span, ul > li");if((o==null?void 0:o.length)>0){const p=Array.from(o).map(v=>v.textContent||"");a=a.concat(p)}else a.push(t.getCellValues(s).filter)}),a=Array.from(new Set(a));const r=i[u].order;function l(s){return r!=null&&r.includes(s)?r.indexOf(s).toString():s}a.sort((s,o)=>(s=l(s),o=l(o),t.alphaNumSort(s,o))),this.hasAttribute("descending")&&a.reverse(),this.options=a}connectedCallback(){var t;const e=this.getAttribute("name");e&&(this.hasAttribute("options")?this.options=((t=this.getAttribute("options"))==null?void 0:t.split(","))||[]:this.findOptions(e),this.render(e))}render(e){if(this.options.length<1)return;const t=this.getAttribute("type")||"select";if(t!=="checkbox"&&this.options.length<2)return;const i=this.getAttribute("label")||e,n=this.hasAttribute("multiple")?"multiple":"",u=this.getAttribute("all")||"All";let c="",h="";const a=t==="select"?`<label for="filter-${e}">${i}</label>`:`<span class="filter-label">${i}</span>`;t==="select"&&(c=`<select id="filter-${e}" name="${e}" ${n}><option value="">${u}</option>`,h="</select>"),t==="radio"&&(c=`<label><input name="${e}" type="radio" value="" checked>${u}</label>`);const r=`${a}${c}${this.options.map(l=>t==="select"?`<option value="${l}">${l}</option>`:t==="radio"||t==="checkbox"?`<label><input type="${t}" name="${e}" value="${l}" />${l}</label>`:"").join("")}${h}`;this.innerHTML=`${r}`}}customElements.define("action-table-filter-menu",A);class L extends HTMLElement{connectedCallback(){const m=this.getAttribute("name");m&&(this.innerHTML=`<label>
            <input type="checkbox" name="${m.toLowerCase()}" value="${this.getAttribute("value")||"on"}" />
            <span>${this.getAttribute("label")||m}</span>
          </label>`)}}customElements.define("action-table-filter-switch",L);class T extends HTMLElement{constructor(){super();b(this,"min",0);b(this,"rangeTotal",0);this.render(),this.addEventListeners()}get name(){return this.getAttribute("name")||""}addEventListeners(){this.addEventListener("input",e=>{const t=this.querySelectorAll("input"),i=this.querySelector("output"),[n,u]=Array.from(t).map(r=>Number(r.value)),c=n.toString(),h=u.toString();i instanceof HTMLOutputElement&&(i.textContent=`${c}-${h}`);const a=this.querySelector(".range-slider-highlight");a instanceof HTMLSpanElement&&(a.style.marginLeft=`${(n-this.min)/this.rangeTotal*100}%`,a.style.width=`${(u-n)/this.rangeTotal*100}%`),n>u&&(e.stopPropagation(),t[0].value=h,t[1].value=c)})}findMinMax(){const e=this.getAttribute("min"),t=this.getAttribute("max");if(e&&t)return[Number(e),Number(t)];const i=this.closest("action-table"),n=i.cols,u=i.tbody,c=n.findIndex(r=>r.name===this.name.toLowerCase());if(c===-1)return[0,0];const h=`td:nth-child(${c+1})`,a=u.querySelectorAll(h);return Array.from(a).reduce((r,l)=>{const s=Number(i.getCellValues(l).filter);let o=r.length===2?r[0]:s,p=r.length===2?r[1]:s;return o=o<s?o:s,p=p>s?p:s,[o,p]},[])}render(){const[e,t]=this.findMinMax(),i=e.toString(),n=t.toString();this.rangeTotal=t-e,this.min=e;const u=this.getAttribute("label")||this.name,c=document.createElement("div");c.textContent=u;const h=document.createElement("div");h.classList.add("range-slider-group");const a=Math.pow(10,Math.round(Math.log10(this.rangeTotal)))/10;function r(d,g){for(const E in g)d.setAttribute(E,g[E])}const l=[e];for(let d=e+a;d<=t;d+=a)l.push(Math.round(d/a)*a);l.includes(t)||l.push(t);const s=document.createElementNS("http://www.w3.org/2000/svg","svg");r(s,{role:"presentation",width:"100%",height:"5"});const o=100/(l.length-1);for(let d=1;d<l.length-1;d++){const g=document.createElementNS("http://www.w3.org/2000/svg","line"),E=`${d*o}%`;r(g,{x1:E,x2:E,y1:"0",y2:"5",stroke:"currentColor","stroke-width":"1"}),s.append(g)}const p=document.createElement("span");p.classList.add("range-slider-highlight"),h.append(s,p);for(let d=0;d<=1;d++){const g=document.createElement("input");r(g,{type:"range",name:this.name,min:i,max:n,"data-range":d===0?"min":"max","aria-label":d===0?"Min":"Max",value:d===0?i:n}),h.append(g)}const v=document.createElement("output");v.innerHTML=`${e}&ndash;${t}`,this.append(c,h,v)}}customElements.define("action-table-filter-range",T);class S extends HTMLElement{constructor(){super();b(this,"actionTable",this.closest("action-table"));b(this,"resetButton",this.querySelector("button[type=reset]"));this.addEventListeners()}connectedCallback(){const e=this.actionTable.filters;Object.keys(e).length>0&&this.setFilterElements(e)}toggleHighlight(e){e.value?e.classList.add("selected"):e.classList.remove("selected")}addEventListeners(){var t;this.addEventListener("input",i=>{const n=i.target;if(n instanceof HTMLSelectElement||n instanceof HTMLInputElement){const u=n.hasAttribute("exclusive")||!!n.closest("[exclusive]"),c=n.hasAttribute("regex")||!!n.closest("[regex]"),h=n.hasAttribute("exact")||!!n.closest("[exact]"),a=n.name.toLowerCase();if(n instanceof HTMLSelectElement){this.toggleHighlight(n);const r=Array.from(n.selectedOptions).map(l=>l.value);this.dispatch({[a]:{values:r,exclusive:u,regex:c,exact:h}})}if(n instanceof HTMLInputElement){if(n.type==="checkbox"){const r=this.querySelectorAll("input[type=checkbox][name="+n.name+"]"),l=Array.from(r).filter(s=>s.checked).map(s=>s.value);this.dispatch({[a]:{values:l,exclusive:u,regex:c,exact:h}})}if(n.type==="radio"&&this.dispatch({[a]:{values:[n.value],exclusive:u,regex:c,exact:h}}),n.type==="range"){const r=this.querySelectorAll("input[type=range][name='"+n.name+"']");let l=[];const s=[];r.forEach(o=>{o.dataset.range==="min"&&(s[0]=o.min,l[0]=o.value),o.dataset.range==="max"&&(s[1]=o.max,l[1]=o.value)}),l.every((o,p)=>o===s[p])&&(l=[]),this.dispatch({[a]:{values:l,range:!0}})}}}}),this.querySelectorAll("input[type='search']").forEach(i=>{function n(c,h=300){let a;return(...r)=>{clearTimeout(a),a=setTimeout(()=>{c(...r)},h)}}const u=i.dataset.event||"input";i.addEventListener(u,()=>{this.toggleHighlight(i),n(()=>this.dispatch({[i.name]:{values:[i.value]}}))()})}),(t=this.resetButton)==null||t.addEventListener("click",()=>{this.resetAllFilterElements(),this.dispatch()}),this.actionTable.addEventListener("action-table-filters-reset",()=>{this.resetAllFilterElements()})}dispatchInput(e){e.dispatchEvent(new Event("input",{bubbles:!0}))}dispatch(e){if(this.resetButton)if(e){let t=this.actionTable.filters||{};t={...t,...e},this.enableReset(this.hasFilters(t))}else this.enableReset(!1);this.dispatchEvent(new CustomEvent("action-table-filter",{detail:e,bubbles:!0}))}enableReset(e=!0){this.resetButton&&(e?this.resetButton.removeAttribute("disabled"):this.resetButton.setAttribute("disabled",""))}hasFilters(e){return Object.keys(e).some(t=>e[t].values.some(i=>i!==""))}resetAllFilterElements(){this.querySelectorAll("select, input").forEach(t=>{t instanceof HTMLInputElement&&(t.type==="checkbox"||t.type==="radio")&&(t.value===""?t.checked=!0:t.checked=!1),(t instanceof HTMLSelectElement||t instanceof HTMLInputElement&&t.type==="search")&&(t.value="",this.toggleHighlight(t)),t instanceof HTMLInputElement&&t.type==="range"&&(t.value=t.dataset.range==="max"?t.max:t.min,this.dispatchInput(t))})}setFilterElements(e){this.hasFilters(e)?(this.enableReset(),Object.keys(e).forEach(t=>this.setFilterElement(t,e[t].values))):this.resetAllFilterElements()}setSelectValueIgnoringCase(e,t){t=t.toLowerCase(),Array.from(e.options).some(i=>(i.value.toLowerCase()||i.text.toLowerCase())===t?(i.selected=!0,this.toggleHighlight(e),!0):!1)}setFilterElement(e,t){if(t.length===0)return;this.querySelectorAll(`select[name="${e}" i], input[name="${e}" i]`).forEach(n=>{n instanceof HTMLSelectElement&&(n.value=t[0],this.setSelectValueIgnoringCase(n,t[0])),n instanceof HTMLInputElement&&(n.type==="checkbox"&&t.includes(n.value)&&(n.checked=!0),n.type==="radio"&&n.value===t[0]&&(n.checked=!0),n.type==="search"&&(n.value=t[0],this.toggleHighlight(n)),n.type==="range"&&(n.dataset.range==="min"&&(n.value=t[0]||n.min,this.dispatchInput(n)),n.dataset.range==="max"&&(n.value=t[1]||n.max,this.dispatchInput(n))))})}}customElements.define("action-table-filters",S);
//# sourceMappingURL=action-table-filters.js.map
